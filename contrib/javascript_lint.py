
# TODO(colin): fix these lint errors (http://pep8.readthedocs.io/en/release-1.7.x/intro.html#error-codes)
# pep8-disable:E127,E128,E131
"""Linter that warns against using bad JavaScript constructs.

For instance, we use $.ajax for all ajax requests, instead of the
`$.get`/`$.post` aliases.
"""

from __future__ import absolute_import

import os
import re

from shared.testutil import lintutil


def lint_jsx_fixture_files(files_to_lint):
    """Ensure that fixture files have an associated fixtures_test.js file."""
    # We only want fixture files
    fixture_files_to_lint = lintutil.filter(files_to_lint,
        suffix=('.jsx.fixture.js', '.jsx.fixture.jsx'))

    for fixture_file in fixture_files_to_lint:
        path, fixture_name = os.path.split(fixture_file)

        # We need to potentially walk up the tree to find the "-package"
        # directory which will old the fixtures_test.js file.
        while path and not path.endswith("-package"):
            path = os.path.dirname(path)
        fixture_test_file = os.path.join(path, "fixtures_test.js")

        # Check to see if the fixtures_test.js file is completely missing
        if not os.path.isfile(fixture_test_file):
            yield (fixture_file, 1,
                   "Fixture files must have an associated fixtures_test.js "
                   "file. Run tools/regen_fixture_tests.sh to create it.")
        else:
            # Otherwise, it exists, so make sure that the fixture file is
            # referenced inside the fixtures_test.js file.
            search_re = re.compile(r'/%s"' % re.escape(fixture_name))
            if not lintutil.line_number(fixture_test_file, search_re, 0):
                yield (fixture_test_file, 1,
                       "Fixture test is missing %s. Run "
                       "tools/regen_fixture_tests.sh to update it." %
                           fixture_name)


# JSX files that are being grandfathered in. You really shouldn't be adding
# files to this list, really only deleting entries as the associated files
# are also removed.
#
# This list was generated by running:
#   git ls-files '*.jsx' | grep -v testfiles | grep -v "\.fixture.jsx" |
#   grep -v node_modules | grep -v testutils | perl -nle 'print qq{    "$_",} .
#   (length > 72 and "  # \@Nolint(long line)") unless -e "$_.fixture.js" or -e "$_.fixture.jsx"'
_JSX_NO_FIXTURE_WHITELIST = [
    "javascript/avatar-customizer-package/avatar-customizer-modal.jsx",
    "javascript/avatar-customizer-package/avatar-customizer.jsx",
    "javascript/backbone-state-mixin-package/backbone-state-mixin.jsx",
    "javascript/bigbingo-dashboard-package/conversion-graphs.jsx",
    "javascript/bigbingo-dashboard-package/experiment-list.jsx",
    "javascript/bigbingo-dashboard-package/experiment-list_test.jsx",
    "javascript/bigbingo-dashboard-package/experiment.jsx",
    "javascript/bigbingo-dashboard-package/funnel/builder.jsx",
    "javascript/bigbingo-dashboard-package/funnel/conversion-picker.jsx",
    "javascript/bigbingo-dashboard-package/funnel/manager.jsx",
    "javascript/bigbingo-dashboard-package/funnel/manager_test.jsx",
    "javascript/bigbingo-dashboard-package/funnel/viewer.jsx",
    "javascript/bigbingo-dashboard-package/graphs.jsx",
    "javascript/bigbingo-dashboard-package/old-button.jsx",
    "javascript/bigbingo-dashboard-package/old-button_test.jsx",
    "javascript/bigbingo-dashboard-package/validated-field_test.jsx",
    "javascript/checklist-package/callout.jsx",
    "javascript/checklist-package/checklist-actions.jsx",
    "javascript/checklist-package/checklist-item.jsx",
    "javascript/checklist-package/checklist-section.jsx",
    "javascript/checklist-package/checklist.jsx",
    "javascript/checklist-package/learn-for-yourself.jsx",
    "javascript/checklist-package/toggle-button.jsx",
    "javascript/checklist-package/tooltip-action.jsx",
    "javascript/ckeditor-package/ckeditor.jsx",
    "javascript/clarifications-package/discussion-base.jsx",
    "javascript/clarifications-package/discussion-meta.jsx",
    "javascript/clarifications-package/discussion-meta_test.jsx",
    "javascript/clarifications-package/extras.jsx",
    "javascript/clarifications-package/low-quality-notice.jsx",
    "javascript/clarifications-package/mod-controls.jsx",
    "javascript/clarifications-package/models.jsx",
    "javascript/clarifications-package/official.jsx",
    "javascript/clarifications-package/shared.jsx",
    "javascript/clarifications-package/userhoverable.jsx",
    "javascript/clarifications-package/usersubmit.jsx",
    "javascript/clever-package/onboarding.jsx",
    "javascript/coach-report-activity-package/htmlbridge.jsx",
    "javascript/coach-report-activity-package/report.jsx",
    "javascript/coach-report-exercises-package/report.jsx",
    "javascript/coach-report-programs-package/report.jsx",
    "javascript/coach-report-progress-by-student-package/activity-tab.jsx",
    "javascript/coach-report-progress-by-student-package/detail-body.jsx",
    "javascript/coach-report-progress-by-student-package/focus-tab.jsx",
    "javascript/coach-report-progress-by-student-package/highchart.jsx",
    "javascript/coach-report-progress-by-student-package/histogram.jsx",
    "javascript/coach-report-progress-by-student-package/masterdetail.jsx",
    "javascript/coach-report-progress-by-student-package/problems-tab.jsx",
    "javascript/coach-report-progress-by-student-package/recommendation-tab.jsx",  # @Nolint(long line)
    "javascript/coach-report-progress-by-student-package/rect.jsx",
    "javascript/coach-report-progress-by-student-package/report.jsx",
    "javascript/coach-report-progress-by-student-package/skill-progress-tab.jsx",  # @Nolint(long line)
    "javascript/coach-report-progress-by-student-package/tab-bar.jsx",
    "javascript/coach-report-progress-by-student-package/topic-progress-tab.jsx",  # @Nolint(long line)
    "javascript/coach-report-progress-by-student-package/video-tab.jsx",
    "javascript/coach-report-topic-package/report.jsx",
    "javascript/commoncore-package/center.jsx",
    "javascript/commoncore-package/common-core-map-main.jsx",
    "javascript/commoncore-package/common-core-map.jsx",
    "javascript/commoncore-package/landing/commoncore-landing.jsx",
    "javascript/commoncore-package/landing/heading.jsx",
    "javascript/commoncore-package/landing/hero.jsx",
    "javascript/commoncore-package/landing/signup-bar.jsx",
    "javascript/components/button-package/hover-behavior.jsx",
    "javascript/components/modal-package/exercise-modal.jsx",
    "javascript/components/modal-package/video-modal.jsx",
    "javascript/content-library-package/components/module-list.jsx",
    "javascript/content-library-package/components/practice-upsell.jsx",
    "javascript/content-library-package/components/sticky-module.jsx",
    "javascript/content-library-package/components/title.jsx",
    "javascript/content-library-package/components/modal-navigator.jsx",
    "javascript/content-library-package/modules/practice-shelf.jsx",
    "javascript/content-library-package/modules/stateful-classes-dashboard.jsx",  # @Nolint(long line)
    "javascript/content-library-package/modules/stateful-content-list.jsx",
    "javascript/content-library-package/modules/stateful-practice-module.jsx",
    "javascript/content-library-package/modules/stateful-practice-shelf.jsx",
    "javascript/content-library-package/modules.jsx",
    "javascript/content-library-package/segmented-progress-ring.jsx",
    "javascript/cs-shared-package/program-square.jsx",
    "javascript/cs-shared-package/userhoverable.jsx",
    "javascript/dashboard-intro-package/dashboard-topic-selector-view.jsx",
    "javascript/dashboard-package/answer-questions-task-entry.jsx",
    "javascript/dashboard-package/app-chrome.jsx",
    "javascript/dashboard-package/bibliotron-homepage.jsx",
    "javascript/dashboard-package/booster-challenge-view.jsx",
    "javascript/dashboard-package/completed-task.jsx",
    "javascript/dashboard-package/countdown-view.jsx",
    "javascript/dashboard-package/datastores/promoted-badges-store.jsx",
    "javascript/dashboard-package/datastores/recent-topic-store.jsx",
    "javascript/dashboard-package/datastores/user-mission-store.jsx",
    "javascript/dashboard-package/exercise-progress-tooltip.jsx",
    "javascript/dashboard-package/hacky-learn-menu-trapper.jsx",
    "javascript/dashboard-package/learning-dashboard.jsx",
    "javascript/dashboard-package/mastered-mission.jsx",
    "javascript/dashboard-package/mastery-challenge-view.jsx",
    "javascript/dashboard-package/mission-dashboard.jsx",
    "javascript/dashboard-package/mission-progress.jsx",
    "javascript/dashboard-package/practiced-bouncy-bars.jsx",
    "javascript/dashboard-package/progress-summary.jsx",
    "javascript/dashboard-package/progress-tile.jsx",
    "javascript/dashboard-package/recent-topic-callout.jsx",
    "javascript/dashboard-package/remove-button.jsx",
    "javascript/dashboard-package/remove-message.jsx",
    "javascript/dashboard-package/simplified-skill-view.jsx",
    "javascript/dashboard-package/suggested-task-list.jsx",
    "javascript/dashboard-package/task-entry.jsx",
    "javascript/dashboard-package/task-preview.jsx",
    "javascript/dashboard-package/upcoming-badges.jsx",
    "javascript/dashboard-package/upcoming-tasks.jsx",
    "javascript/dashboard-package/update-pauser.jsx",
    "javascript/devadmin-package/learn-menu-editor.jsx",
    "javascript/devadmin-package/logs-viewer.jsx",
    "javascript/devadmin-package/permissions.jsx",
    "javascript/devadmin-package/progress-summary.jsx",
    "javascript/devadmin-package/progress.jsx",
    "javascript/devadmin-package/thumbnails-fixture.jsx",
    "javascript/devadmin-package/username-editor.jsx",
    "javascript/donate-package/donate-form-container.jsx",
    "javascript/donate-package/donate-modal.jsx",
    "javascript/donate-package/methods/util.jsx",
    "javascript/donorschoose-package/teacher-signup-form.jsx",
    # TODO(emily/riley): fix this fixture (see the fixture test file)
    "javascript/editor-package/ckeditor-widget.jsx",
    "javascript/editor-package/editor-status-controller.jsx",
    "javascript/editor-package/editor-status-view.jsx",
    "javascript/editor-package/publish-status-init.jsx",
    "javascript/editor-package/thumbnail-widget.jsx",
    "javascript/eduorg-picker-package/eduorg-picker.jsx",
    "javascript/error-monitor-package/bar-chart.jsx",
    "javascript/error-monitor-package/error-details.jsx",
    "javascript/error-monitor-package/error-monitor.jsx",
    "javascript/error-monitor-package/error-table-row.jsx",
    "javascript/error-monitor-package/error-table-time-series.jsx",
    "javascript/error-monitor-package/error-table.jsx",
    "javascript/error-monitor-package/push-state-link.jsx",
    "javascript/exercise-search-package/exercise-search.jsx",
    "javascript/exerciseissues-package/exerciseissues.jsx",
    "javascript/exercises-components-package/drawing-area.jsx",
    "javascript/exercises-legacy-package/components/exercise-footer.jsx",
    "javascript/exercises-legacy-package/current-card-view.jsx",
    "javascript/exercises-legacy-package/exercise-chrome.jsx",
    "javascript/exercises-legacy-package/exercise-problem-template.jsx",
    "javascript/exercises-legacy-package/upload-image.jsx",
    "javascript/exercises-legacy-package/worked-example.jsx",
    # TODO(emily): remove these files
    "javascript/exercises-package/components/exercise-chrome.jsx",
    "javascript/exercises-package/components/exercise-footer.jsx",
    "javascript/exercises-package/components/exercise-problem-template.jsx",
    "javascript/exercises-package/stateful-exercise-manager.jsx",
    "javascript/exercises-package/components/library-exercise.jsx",
    "javascript/exercises-package/components/missions-exercise.jsx",
    "javascript/exercises-package/components/practice-exercise.jsx",
    "javascript/homeschool-package/heading.jsx",
    "javascript/homeschool-package/hero.jsx",
    "javascript/homeschool-package/homeschool-landing.jsx",
    "javascript/homeschool-package/signup-bar.jsx",
    "javascript/issues-package/i18n-form.jsx",
    "javascript/issues-package/issues.jsx",
    "javascript/location-picker-package/location-picker.jsx",
    "javascript/login-package/add-child/buttons-block.jsx",
    "javascript/login-package/add-child/logout-buttons-block.jsx",
    "javascript/login-package/add-child/no-email.jsx",
    "javascript/login-package/birthday-picker.jsx",
    "javascript/login-package/facebook-button.jsx",
    "javascript/login-package/google-button.jsx",
    # TODO(kairui): Remove when we no longer have an entirely separate embedded
    # log in view for mobile apps.
    "javascript/login-package/login-form-legacy.jsx",
    "javascript/login-package/signup-modal.jsx",
    "javascript/manticore-package/manticore-article-editor.jsx",
    "javascript/manticore-package/manticore-article-preview-tab.jsx",
    "javascript/manticore-package/manticore-article-side-by-side-tab.jsx",
    "javascript/manticore-package/manticore-article-tab-bar.jsx",
    "javascript/manticore-package/manticore-description-editor.jsx",
    "javascript/manticore-package/manticore-editor_test.jsx",
    "javascript/manticore-package/manticore-exercise-editor.jsx",
    "javascript/manticore-package/manticore-exercise-editor_test.jsx",
    "javascript/manticore-package/manticore-khan-exercise-editor.jsx",
    "javascript/manticore-package/manticore-platform-editor.jsx",
    "javascript/manticore-package/manticore-scratchpad-editor.jsx",
    "javascript/manticore-package/manticore-simple-editor.jsx",
    "javascript/manticore-package/sticky.jsx",
    "javascript/moderation-package/hover-card-item.jsx",
    "javascript/moderation-package/moderator-list.jsx",
    "javascript/notifications-package/age-selector.jsx",
    "javascript/notifications-package/donate-notification.jsx",
    "javascript/notifications-package/hourofcode-notification-view.jsx",
    "javascript/notifications-package/rio-2016-notification-base.jsx",
    "javascript/notifications-package/rio-2016-phantom-notification.jsx",
    "javascript/odometer-package/odometer.jsx",
    "javascript/page-package/header-search-box.jsx",
    "javascript/page-package/learn-menu.jsx",
    "javascript/parent-package/activity-group.jsx",
    "javascript/parent-package/activity-summary.jsx",
    "javascript/parent-package/badge-group.jsx",
    "javascript/parent-package/child-invite.jsx",
    "javascript/parent-package/child-page-sidebar.jsx",
    "javascript/parent-package/child-page.jsx",
    "javascript/parent-package/child-preview.jsx",
    "javascript/parent-package/email-changer.jsx",
    "javascript/parent-package/main-homepage.jsx",
    "javascript/parent-package/move-to-students.jsx",
    "javascript/parent-package/no-activity-message.jsx",
    "javascript/parent-package/parent-checklist-section.jsx",
    "javascript/parent-package/parent-homepage.jsx",
    "javascript/parent-package/parent-nav.jsx",
    "javascript/parent-package/remove-child-widget.jsx",
    "javascript/periodic-table-package/periodic-table.jsx",
    "javascript/perseus-admin-package/image-upload-dialog.jsx",
    "javascript/perseus-admin-package/perseus-i18n.jsx",
    "javascript/perseus-admin-package/preview-item-list.jsx",
    "javascript/perseus-one-package/actions.jsx",
    "javascript/perseus-one-package/application-state-store.jsx",
    "javascript/perseus-one-package/button-row.jsx",
    "javascript/perseus-one-package/centerer.jsx",
    "javascript/perseus-one-package/common-attempts.jsx",
    "javascript/perseus-one-package/constants.jsx",
    "javascript/perseus-one-package/diff-list.jsx",
    "javascript/perseus-one-package/diff.jsx",
    "javascript/perseus-one-package/editable-item-name.jsx",
    "javascript/perseus-one-package/exercise-store.jsx",
    "javascript/perseus-one-package/exit-button.jsx",
    "javascript/perseus-one-package/item-area.jsx",
    "javascript/perseus-one-package/item-controls.jsx",
    "javascript/perseus-one-package/item-name.jsx",
    "javascript/perseus-one-package/item-store.jsx",
    "javascript/perseus-one-package/main.jsx",
    "javascript/perseus-one-package/move-type-modal.jsx",
    "javascript/perseus-one-package/select2.jsx",
    "javascript/perseus-one-package/shapes.jsx",
    "javascript/perseus-one-package/sidebar.jsx",
    "javascript/perseus-one-package/tab-area.jsx",
    "javascript/perseus-one-package/tagit.jsx",
    "javascript/perseus-one-package/type-name.jsx",
    "javascript/perseus-preview-package/frame-exercise.jsx",
    "javascript/perseus-preview-package/preview.jsx",
    "javascript/perseus-preview-package/preview-frame.jsx",
    "javascript/profile-nav-package/badge-counts.jsx",
    "javascript/profile-nav-package/streak-actions.jsx",
    "javascript/profile-nav-package/streak-counter.jsx",
    "javascript/profile-nav-package/streak-store.jsx",
    "javascript/profile-nav-package/streak-style.jsx",
    "javascript/profile-nav-package/user-points-and-badges.jsx",
    "javascript/profile-nav-package/username-picker.jsx",
    "javascript/profile-package/profile-streak-widget.jsx",
    "javascript/profile-package/profile-widget-mixin.jsx",
    "javascript/profile-package/profile-widgets.jsx",
    "javascript/profile-package/streak-widget-store-controller.jsx",
    "javascript/profile-package/widget-privacy-view.jsx",
    "javascript/profile-reports-package/checkbox.jsx",
    "javascript/profile-reports-package/checkbox_test.jsx",
    "javascript/profile-reports-package/profile-reports.jsx",
    "javascript/profile-settings-package/bio-picker.jsx",
    "javascript/profile-settings-package/profile-settings.jsx",
    "javascript/profile-settings-package/with-css.jsx",
    "javascript/projectfeedback-package/projectfeedback-form.jsx",
    "javascript/projectfeedback-package/projectfeedback-form_test.jsx",
    "javascript/publish-package/publish-context-store.jsx",
    "javascript/publish-package/publish-status.jsx",
    "javascript/publish-package/publish-view.jsx",
    "javascript/react-sandbox-package/sandbox-fixture.jsx",
    "javascript/react-sandbox-package/sandbox-fixtures.jsx",
    "javascript/react-sandbox-package/sandbox-form.jsx",
    "javascript/recommendations-package/due-date.jsx",
    "javascript/recommendations-package/exercise-picker.jsx",
    "javascript/recommendations-package/recommendations.jsx",
    "javascript/reports-package/coach-reports-empty-page.jsx",
    "javascript/reports-package/coach-reports-page.jsx",
    "javascript/reports-package/coach-reports.jsx",
    "javascript/reports-package/datepicker.jsx",
    "javascript/reports-package/exercisefilter.jsx",
    "javascript/reports-package/filterbar.jsx",
    "javascript/reports-package/filtermodel.jsx",
    "javascript/reports-package/reports-shared.jsx",
    "javascript/reports-package/select.jsx",
    "javascript/sat-mission-package/animation.jsx",
    "javascript/sat-mission-package/timeout.jsx",
    "javascript/sat-mission-package/components/dashboard-exams.jsx",
    "javascript/sat-mission-package/components/dashboard-overview.jsx",
    "javascript/sat-mission-package/components/dashboard-practice.jsx",
    "javascript/sat-mission-package/components/dashboard-tips.jsx",
    "javascript/sat-mission-package/components/dashboard.jsx",
    "javascript/sat-mission-package/components/icons.jsx",
    "javascript/sat-mission-package/components/maybe-native-date-picker.jsx",
    "javascript/sat-mission-package/components/mission.jsx",
    "javascript/sat-mission-package/components/overview-ctas/cta-wrapper.jsx",
    "javascript/sat-mission-package/components/routes.jsx",
    "javascript/sat-mission-package/components/sat-perseus-renderer.jsx",
    "javascript/sat-mission-package/components/schedule-creator/schedule-creator-form.jsx",
    "javascript/sat-mission-package/components/schedule-creator/schedule-creator-progress-boxes.jsx",  # @Nolint(long line)
    "javascript/sat-mission-package/components/section.jsx",
    "javascript/sat-mission-package/components/task-from-skill.jsx",
    "javascript/sat-mission-package/components/task-view.jsx",
    "javascript/search-package/task-preview.jsx",
    "javascript/schoolboard-package/hero.jsx",
    "javascript/schoolboard-package/schoolboard-landing.jsx",
    "javascript/schoolboard-package/signup-bar.jsx",
    "javascript/scratchpads-package/edit-controls.jsx",
    "javascript/search-package/highlight.jsx",
    "javascript/search-package/mission-callouts.jsx",
    "javascript/search-package/mobile-search-form.jsx",
    "javascript/search-package/search-results-list.jsx",
    "javascript/search-package/search-results.jsx",
    "javascript/session-survey-package/session-survey.jsx",
    "javascript/settings-package/allow-coaches-setting.jsx",
    "javascript/settings-package/email-reports-section.jsx",
    "javascript/settings-package/email-settings.jsx",
    "javascript/settings-package/email-subscription.jsx",
    "javascript/settings-package/general-section.jsx",
    "javascript/settings-package/key-subscription.jsx",
    "javascript/settings-package/newsletters-section.jsx",
    "javascript/settings-package/notifications-section.jsx",
    "javascript/settings-package/primary-email-section.jsx",
    "javascript/settings-package/toggle-switch.jsx",
    "javascript/shared-components-package/kui-button_test.jsx",
    "javascript/shared-package/json-inspector.jsx",
    "javascript/shared-styles-package/aphrodite-css-transition-group.jsx",
    "javascript/stats-tables-package/chi2-table.jsx",
    "javascript/stats-tables-package/stats-table.jsx",
    "javascript/stats-tables-package/t-table.jsx",
    "javascript/stats-tables-package/z-table.jsx",
    "javascript/stories-package/stories-page.jsx",
    "javascript/stories-package/story-focus.jsx",
    "javascript/stories-package/story-form.jsx",
    "javascript/stories-package/timeout-transition-group.jsx",
    "javascript/style-package/affixed.jsx",
    "javascript/style-package/show-example.jsx",
    "javascript/tasks-package/content-header.jsx",
    "javascript/tasks-package/task-container.jsx",
    "javascript/tasks-package/tutorial-nav-toggle.jsx",
    "javascript/tasks-secondary-package/countdown-view.jsx",
    "javascript/tasks-secondary-package/end-of-mastery-task-header.jsx",
    "javascript/tasks-secondary-package/end-of-task-avatar-parts.jsx",
    "javascript/tasks-secondary-package/end-of-task-footer.jsx",
    "javascript/tasks-secondary-package/exercise-progress-view.jsx",
    "javascript/tasks-secondary-package/task-header.jsx",
    "javascript/tasks-secondary-package/video-task-status.jsx",
    "javascript/topic-progress-package/topic-progress-icon.jsx",
    "javascript/topicsadmin-package/content-view.jsx",
    "javascript/translation-analytics-package/dubs-per-month-chart_test.jsx",
    "javascript/translation-editor-package/translation-editor.jsx",
    "javascript/translations-dashboard-package/clientside-link.jsx",
    #
    # This file (`dash-page.jsx`) does not have an associated fixture
    # because it does not export a React component;
    # rather, it exports a function that creates React components.
    # The tests for {Article,Exercises,Scratchpad}DashPage
    # call the function exported by this file,
    # so we have total test coverage.
    "javascript/translations-dashboard-package/dash-page.jsx",
    #
    "javascript/translations-dashboard-package/dash-table-row.jsx",
    "javascript/translations-dashboard-package/dash-table-wrapper.jsx",
    "javascript/translations-dashboard-package/dash-theme.jsx",
    "javascript/translations-dashboard-package/external-link.jsx",
    "javascript/translations-dashboard-package/sortable-table_test.jsx",
    "javascript/translations-dashboard-package/translations-dashboard.jsx",
    "javascript/translations-dashboard-package/video-translation-editor_test.jsx",  # @Nolint(long line)
    "javascript/tutorial-editor-package/add-existing-content-view.jsx",
    "javascript/tutorial-editor-package/add-scratchpad-view.jsx",
    "javascript/tutorial-editor-package/add-youtube-video-view.jsx",
    "javascript/tutorial-editor-package/content-header-view.jsx",
    "javascript/tutorial-editor-package/exercise-edit-view.jsx",
    "javascript/tutorial-editor-package/particle-modal.jsx",
    "javascript/tutorial-editor-package/perseus-modal.jsx",
    "javascript/tutorial-editor-package/project-modal.jsx",
    "javascript/tutorial-editor-package/video-edit-view.jsx",
    "javascript/typeahead-package/search-results-popup.jsx",
    "javascript/typeahead-package/task-preview.jsx",
    "javascript/video-package/video-player/video-player.jsx",
    "javascript/video-testimonials-package/video-testimonials.jsx",
]


def lint_fixture_files(files_to_lint):
    # We only care about "plain" jsx files
    # We also want to ignore test files
    jsx_files_to_lint = lintutil.filter(files_to_lint, suffix=('.jsx'),
        exclude_substrings=_JSX_NO_FIXTURE_WHITELIST +
            ['testfiles', 'testutils', '.fixture.jsx'])

    for jsx_file in jsx_files_to_lint:
        if (not os.path.isfile(jsx_file + ".fixture.js") and
                not os.path.isfile(jsx_file + ".fixture.jsx")):
            yield (jsx_file, 1,
                   ".jsx files must have an associated "
                   ".jsx.fixture.js file.")


# JS files that are being grandfathered in. You really shouldn't be adding
# files to this list, really only deleting entries as the associated files
# are also removed.
#
# This list was generated by running:
#   git ls-files 'javascript/*.js' |
#     grep -v -e 'node_modules' -e '_test.js$' -e '.fixture.js$' |
#     perl -nle '($t = $_) =~ s/\.js$/_test.js/; print qq{    "$_",} .
#       (length > 72 and "  # \@Nolint(long line)") unless -e $t'
_JS_NO_TEST_WHITELIST = [
    "javascript/about-package/about.js",
    "javascript/about-package/team.js",
    "javascript/bigbingo-dashboard-package/bigbingo-dashboard.js",
    "javascript/bigbingo-dashboard-package/bigbingo-router.js",
    "javascript/bigbingo-dashboard-package/constants.js",
    "javascript/bigbingo-dashboard-package/conversions-store.js",
    "javascript/bigbingo-dashboard-package/datastores/actions.js",
    "javascript/bigbingo-dashboard-package/datastores/start-time-store.js",
    "javascript/bigbingo-dashboard-package/funnel/api.js",
    "javascript/bigbingo-dashboard-package/segments-store.js",
    "javascript/bloodhound-package/bloodhound.js",
    "javascript/calculator-package/init-calculator.js",
    "javascript/checklist-package/get-checklist.js",
    "javascript/ckeditor-package/ckeditor-utils.js",
    "javascript/class-creator-package/types.js",
    "javascript/class-creator-package/styles.js",
    "javascript/class-package/types.js",
    "javascript/class-package/icons.js",
    "javascript/coach-dashboard-package/styles/shared-styles.js",
    "javascript/coach-dashboard-package/students/types.js",
    "javascript/coach-dashboard-package/students/transfer-students-mutation.js",
    "javascript/coach-report-exercise-package/fixture-data.js",
    "javascript/coach-report-exercise-package/styles/shared-styles.js",
    "javascript/coach-report-progress-by-student-package/activity-graph.js",
    "javascript/coach-report-progress-by-student-package/exercise-problems-graph.js",  # @Nolint(long line)
    "javascript/coach-report-progress-by-student-package/focus-graph.js",
    "javascript/coach-report-shared-package/types.js",
    "javascript/commoncore-package/landing/colors.js",
    "javascript/components/button-package/button-utils.js",
    "javascript/components/button-package/types.js",
    "javascript/content-library-package/redux/modal-navigator-store.js",
    "javascript/content-library-package/redux/modal-navigator-reducer.js",
    "javascript/content-library-package/redux/user-info-store.js",
    "javascript/content-library-package/redux/user-info-actions.js",
    "javascript/content-library-package/redux/user-info-constants.js",
    "javascript/content-library-package/styles/functions.js",
    "javascript/content-library-package/styles/shared.js",
    "javascript/content-library-package/modules/classes-dashboard-store.js",
    "javascript/content-library-package/modules/classes-dashboard-types.js",
    "javascript/content-library-package/modules/practice-prop-types.js",
    "javascript/content-library-package/modules/practice-types.js",
    "javascript/content-library-package/modules/subject-upsell-types.js",
    "javascript/content-models-package/content-models.js",
    "javascript/corelibs-legacy-package/jquery.delayload.js",
    "javascript/corelibs-legacy-package/react-config-dev.js",
    "javascript/corelibs-legacy-package/react-config-prod.js",
    "javascript/corelibs-legacy-package/underscore-extensions.js",
    "javascript/dashboard-package/dashboard-focus-mode.js",
    "javascript/dashboard-package/datastores/completed-task-store.js",
    "javascript/dashboard-package/datastores/content-info-store.js",
    "javascript/dashboard-package/datastores/dashboard-actions.js",
    "javascript/dashboard-package/datastores/dashboard-options-store.js",
    "javascript/dashboard-package/datastores/dashboard-state-store.js",
    "javascript/dashboard-package/datastores/hidden-descriptor-store.js",
    "javascript/dashboard-package/datastores/next-mastery-date-store.js",
    "javascript/dashboard-package/datastores/task-descriptor-store.js",
    "javascript/dashboard-package/task-presenter.js",
    "javascript/devadmin-package/content-permissions/prop-types.js",
    "javascript/devadmin-package/content-permissions/constants.js",
    "javascript/devadmin-package/content-permissions/shared-styles.js",
    "javascript/devadmin-package/dev-admin.js",
    "javascript/devadmin-package/organization-leaderboard.js",
    "javascript/discussion-package/clarifications.js",
    "javascript/discussion-package/discussion-answers.js",
    "javascript/discussion-package/discussion-comments.js",
    "javascript/discussion-package/discussion-list.js",
    "javascript/discussion-package/discussion-note.js",
    "javascript/discussion-package/discussion-profilepromo.js",
    "javascript/discussion-package/discussion-projectfeedback.js",
    "javascript/discussion-package/discussion-questions.js",
    "javascript/discussion-package/discussion-replies.js",
    "javascript/discussion-package/discussion-voting.js",
    "javascript/discussion-package/discussion.js",
    "javascript/discussion-package/duplicate-notice.js",
    "javascript/discussion-package/flag.js",
    "javascript/discussion-package/guidelines.js",
    "javascript/discussion-package/low-quality-notice.js",
    "javascript/discussion-package/moderation.js",
    "javascript/discussion-package/queue.js",
    "javascript/discussion-package/report-a-mistake.js",
    "javascript/donate-package/amounts.js",
    "javascript/donate-package/donate.js",
    "javascript/donate-package/media-queries.js",
    "javascript/donate-package/methods/paypal.js",
    "javascript/donate-package/methods/stripe.js",
    "javascript/drawing-area-package/drawing.js",
    "javascript/drawing-area-package/drawing-scratchpad.js",
    "javascript/editor-package/content-log.js",
    "javascript/editor-package/editor-models.js",
    "javascript/editor-package/tag-model.js",
    "javascript/editor-package/user-authored-content-types.js",
    "javascript/error-monitor-package/parse-category-date-string.js",
    "javascript/exercises-legacy-package/bottomless-queue.js",
    "javascript/exercises-legacy-package/exercise-card-stack.js",
    "javascript/exercises-legacy-package/exercise-card.js",
    "javascript/exercises-legacy-package/exercises.js",
    "javascript/exercises-legacy-package/history.js",
    "javascript/exercises-legacy-package/interface.js",
    "javascript/exercises-legacy-package/khan-exercise.js",
    "javascript/exercises-legacy-package/perseus-bridge.js",
    "javascript/exercises-legacy-package/related-videos.js",
    "javascript/exercises-legacy-package/user-exercise-cache.js",
    "javascript/exercises-package/common-styles.js",
    "javascript/google-classroom-package/googleutil.js",
    "javascript/highcharts-package/highcharts-l10n.js",
    "javascript/homeschool-package/colors.js",
    "javascript/hover-card-package/hover-card-view.js",
    "javascript/ie-warning.js",
    "javascript/interns-package/interns.js",
    "javascript/json-stream-reporter.js",
    "javascript/katex-package/wait-for-fonts.js",
    "javascript/login-package/add-child/dao.js",
    "javascript/login-package/add-child/is-valid-email.js",
    "javascript/login-package/centered-popup-window.js",
    "javascript/login-package/completesignup.js",
    "javascript/login-package/constants.js",
    "javascript/login-package/create-post-login-url.js",
    "javascript/login-package/dupeaccount.js",
    "javascript/login-package/form-mixin.js",
    "javascript/login-package/invitesignup.js",
    "javascript/login-package/login-legacy.js",
    "javascript/login-package/login.js",
    "javascript/login-package/password-change.js",
    "javascript/login-package/shared-styles.js",
    "javascript/login-package/signup.js",
    "javascript/manticore-package/async-queue.js",
    "javascript/manticore-package/manticore-theme.js",
    "javascript/maps-package/knowledgemap.js",
    "javascript/maps-package/models.js",
    "javascript/maps-package/views.js",
    "javascript/message-box-package/message-box.js",
    "javascript/missions-package/user-mission.js",
    "javascript/mobile-shared-package/exercise-progress-constants.js",
    "javascript/mobile-shared-package/exercise-progress-utils.js",
    "javascript/mobile-shared-package/main.js",
    "javascript/nav-package/khan-nav.js",
    "javascript/notifications-package/accept-terms-of-service-notification-view.js",  # @Nolint(long line)
    "javascript/notifications-package/banner-notification-view.js",
    "javascript/notifications-package/base-notification-view.js",
    "javascript/notifications-package/common-core-notification-view.js",
    "javascript/notifications-package/config.js",
    "javascript/notifications-package/email-bounce-notification-view.js",
    "javascript/notifications-package/i18n-live-notification-view.js",
    "javascript/notifications-package/issue-loader.js",
    "javascript/notifications-package/learning-dashboard-notification-view.js",
    "javascript/notifications-package/link-email-notification-view.js",
    "javascript/notifications-package/notification-dialog-view.jsx",
    "javascript/notifications-package/phantom-notification-view.js",
    "javascript/notifications-package/readable-notification-view.js",
    "javascript/notifications-package/request-notification-view.js",
    "javascript/notifications-package/restricted-domain-age-check-notification-view.js",  # @Nolint(long line)
    "javascript/notifications-package/urgent-notification-view.js",
    "javascript/notifications-package/verify-email-notification-view.js",
    "javascript/old-throbber-package/spinner.js",
    "javascript/page-package/actions.js",
    "javascript/page-package/big-bingo-links.js",
    "javascript/page-package/constants.js",
    "javascript/page-package/domain-utils.js",
    "javascript/page-package/urls.js",
    "javascript/parent-package/api/add-child-student.js",
    "javascript/parent-package/api/change-invite.js",
    "javascript/parent-package/api/delete-invite.js",
    "javascript/parent-package/api/delete-request.js",
    "javascript/parent-package/api/get-students.js",
    "javascript/parent-package/api/post.js",
    "javascript/parent-package/api/remove-child-student.js",
    "javascript/parent-package/api/stop-coaching.js",
    "javascript/parent-package/get-child-details.js",
    "javascript/parent-package/lazy-children.js",
    "javascript/parent-package/scroll-into-view-if-needed.js",
    "javascript/parent-package/walk-through.js",
    "javascript/periodic-table-package/periodic-table-data.js",
    "javascript/perseus-admin-package/perseus-0-item-version.js",
    "javascript/perseus-admin-package/perseus-1-item-version.js",
    "javascript/perseus-admin-package/perseus-2-item-version.js",
    "javascript/perseus-admin-package/perseus-3-item-version.js",
    "javascript/perseus-admin-package/perseus-4-item-version.js",
    "javascript/perseus-admin-package/perseus-5-item-version.js",
    "javascript/perseus-admin-package/perseus-6-item-version.js",
    "javascript/perseus-admin-package/perseus-7-item-version.js",
    "javascript/perseus-admin-package/perseus-8-item-version.js",
    "javascript/perseus-admin-package/perseus-9-item-version.js",
    "javascript/perseus-admin-package/perseus-10-item-version.js",
    "javascript/perseus-admin-package/perseus-admin.js",
    "javascript/perseus-admin-package/perseus-versions.js",
    "javascript/perseus-editor-package/editor-perseus.js",
    "javascript/perseus-one-package/lens.js",
    "javascript/perseus-package/marked.js",
    "javascript/perseus-package/perseus-0.js",
    "javascript/perseus-package/perseus-1.js",
    "javascript/perseus-package/perseus-2.js",
    "javascript/perseus-package/perseus-3.js",
    "javascript/perseus-package/perseus-4.js",
    "javascript/perseus-package/perseus-5.js",
    "javascript/perseus-package/perseus-6.js",
    "javascript/perseus-package/perseus-7.js",
    "javascript/perseus-package/perseus-8.js",
    "javascript/perseus-package/perseus-9.js",
    "javascript/perseus-package/perseus-10.js",
    "javascript/perseus-package/perseus-slim.js",
    "javascript/perseus-package/perseus-extras.js",
    "javascript/phantom-package/notifications.js",
    "javascript/profile-analytics-package/profile-analytics.js",
    "javascript/profile-intro-package/profile-intro.js",
    "javascript/profile-nav-package/browser-supports-css-transitions.js",
    "javascript/profile-nav-package/dashboard-constants.js",
    "javascript/profile-nav-package/long-settimeout.js",
    "javascript/profile-nav-package/profile-router.js",
    "javascript/profile-nav-package/profile.js",
    "javascript/profile-package/badge-display-case.js",
    "javascript/profile-package/coaches.js",
    "javascript/profile-package/profile-discussion.js",
    "javascript/profile-package/profile-tabs.js",
    "javascript/profile-package/profile-widget-model.js",
    "javascript/program-enrollment-package/models.js",
    "javascript/react-sandbox-package/normalize-bindings.js",
    "javascript/recommendations-package/jquery.exercise-preview.js",
    "javascript/reports-package/consts.js",
    "javascript/reports-package/manifest.js",
    "javascript/reports-package/timezone.js",
    "javascript/restricted-domains-package/restricted-domains.js",
    "javascript/sat-mission-package/action-creators.js",
    "javascript/sat-mission-package/components/calendar/constants.js",
    "javascript/sat-mission-package/components/calendar/util.js",
    "javascript/sat-mission-package/components/overview-ctas/overview-cta-util.js",  # @Nolint(long line)
    "javascript/sat-mission-package/constants.js",
    "javascript/sat-mission-package/official-practice-days.js",
    "javascript/sat-mission-package/stores/exercise-store.js",
    "javascript/sat-mission-package/stores/item-store.js",
    "javascript/sat-mission-package/stores/overview-info-store.js",
    "javascript/sat-mission-package/stores/problem-attempt-store.js",
    "javascript/sat-mission-package/stores/recommendations-store.js",
    "javascript/sat-mission-package/stores/related-video-progress-store.js",
    "javascript/sat-mission-package/stores/request-store.js",
    "javascript/sat-mission-package/stores/route-store.js",
    "javascript/sat-mission-package/stores/skill-category-store.js",
    "javascript/sat-mission-package/stores/skill-store.js",
    "javascript/sat-mission-package/stores/store-hacks.js",
    "javascript/sat-mission-package/stores/task-store.js",
    "javascript/sat-mission-package/stores/tip-store.js",
    "javascript/sat-mission-package/stores/user-form-list-store.js",
    "javascript/sat-mission-package/stores/user-sat-data-store.js",
    "javascript/sat-mission-package/stores/video-store.js",
    "javascript/sat-mission-package/util.js",
    "javascript/schema-viewer-package/schema-viewer.js",
    "javascript/scratchpad-base-package/scratchpads.js",
    "javascript/scratchpad-challenge-package/scratchpad-challenge.js",
    "javascript/scratchpads-drawing-package/method-draw-config.js",
    "javascript/scratchpads-package/scratchpad-bingo.js",
    "javascript/scratchpads-package/scratchpad-ui-challenge.js",
    "javascript/scratchpads-package/scratchpad-ui-dev.js",
    "javascript/scratchpads-package/scratchpad-ui-playback.js",
    "javascript/scratchpads-package/scratchpad-ui-project.js",
    "javascript/scratchpads-package/scratchpad-ui.js",
    "javascript/scroll-utils-package/scroll-utils.js",
    "javascript/search-package/search-page.js",
    "javascript/settings-package/forms.js",
    "javascript/settings-package/settings.js",
    "javascript/shared-package/a11y.js",
    "javascript/shared-package/console.js",
    "javascript/shared-package/dom-utils.js",
    "javascript/shared-package/eduorg-models.js",
    "javascript/shared-package/exercise-progress-constants.js",
    "javascript/shared-package/facebookutil.js",
    "javascript/shared-package/hotload-client.js",
    "javascript/shared-package/location-model.js",
    "javascript/shared-package/parse-query-string.js",
    "javascript/shared-package/site-infra.js",
    "javascript/shared-package/social.js",
    "javascript/shared-package/update-document-title.js",
    "javascript/shared-package/urgent-notification.js",
    "javascript/shared-styles-package/a11y.js",
    "javascript/shared-styles-package/constants.js",
    "javascript/shared-styles-package/fontawesome-constants.js",
    "javascript/shared-styles-package/global-styles.js",
    "javascript/shared-styles-package/media-queries.js",
    "javascript/signup-link-package/bind-signup-links.js",
    "javascript/signup-link-package/launch-signup-login-in-modal.js",
    "javascript/source-map.js",
    "javascript/stories-package/domain-for-story.js",
    "javascript/stories-package/story-editor.js",
    "javascript/tasks-package/booster-task.js",
    "javascript/tasks-package/completion-criteria-formatter.js",
    "javascript/tasks-package/datastores/task-store.js",
    "javascript/tasks-package/exercise-level-to-label.js",
    "javascript/tasks-package/exercise-task.js",
    "javascript/tasks-package/learning-task-descriptor.js",
    "javascript/tasks-package/mastery-task.js",
    "javascript/tasks-package/practice-task.js",
    "javascript/tasks-package/task-launcher.js",
    "javascript/tasks-package/video-task.js",
    "javascript/tasks-secondary-package/end-of-mastery-progress-view.js",
    "javascript/testindex.js",
    "javascript/testutil.js",
    "javascript/testutils/mock-api.js",
    "javascript/transcripts-package/transcripts.js",
    "javascript/translate-package/jipt-interface.js",
    "javascript/translations-dashboard-package/platform-progress-node.js",
    "javascript/translations-dashboard-package/translations-action-creators.js",  # @Nolint(long line)
    "javascript/translations-dashboard-package/translations-constants.js",
    "javascript/tutorial-editor-package/autocomplete.js",
    "javascript/tutorial-exercise-extra-widgets-package/__fixture_data__/counting-1-20-objects.js",  # @Nolint(long line)
    "javascript/typeahead-package/suggestion-source.js",
    "javascript/typeahead-vanilla-package/typeahead.js",
    "javascript/user-progress-cache-package/user-progress-cache.js",
    "javascript/video-package/video-fixture-stub.js",
    "javascript/ycla-package/ycla.js",
]


def lint_js_test_files(files_to_lint):
    # We only want .js files that are inside the javascript directory
    # We don't care if tests or fixtures have tests
    js_files_to_lint = lintutil.filter(files_to_lint,
        prefix=('javascript/'),
        suffix=('.js'),
        exclude_substrings=['.jsx.fixture.js', '_test.js'] +
            _JS_NO_TEST_WHITELIST)

    for js_file in js_files_to_lint:
        test_file = js_file.replace(".js", "_test.js")
        if not os.path.isfile(test_file):
            yield (js_file, 1,
                   ".js files must have an associated _test.js file.")
